<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Existing head content -->
</head>
<body>
    <div class="login-container">
        <h2>Welcome Back</h2>
        <form id="loginForm" onsubmit="return validateForm(event)">
            <div class="form-group">
                <input type="text" id="username" name="username" placeholder=" " required>
                <label for="username">Username</label>
            </div>
            <div class="form-group">
                <input type="password" id="password" name="password" placeholder=" " required>
                <label for="password">Password</label>
            </div>
            <button type="submit">Sign In</button>
        </form>
        <p id="error-message" class="error"></p>
    </div>

    <script>
        // Check if the user is already logged in
        if (localStorage.getItem("isLoggedIn") === "true") {
            window.location.href = "proxy.html"; // Redirect to proxy.html if already logged in
        }

        async function validateForm(event) {
            event.preventDefault();
            
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const errorMessage = document.getElementById("error-message");
            
            try {
                const response = await fetch('credentials.json');
                const data = await response.json();
                
                const user = data.users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    localStorage.setItem("isLoggedIn", "true");
                    errorMessage.textContent = "Login successful! Redirecting...";
                    errorMessage.style.color = "#16a34a";
                    setTimeout(() => {
                        window.location.href = "https://themdashraful2207.github.io/civilapp/proxy.html";
                    }, 1000);
                } else {
                    errorMessage.textContent = "Invalid username or password";
                    errorMessage.classList.add('shake');
                    setTimeout(() => errorMessage.classList.remove('shake'), 500);
                }
            } catch (error) {
                errorMessage.textContent = "Error loading credentials";
                errorMessage.classList.add('shake');
                setTimeout(() => errorMessage.classList.remove('shake'), 500);
                console.error(error);
            }
            return false;
        }
    </script>
</body>
</html>
