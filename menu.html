<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <style>
        /* Your existing CSS remains unchanged */
    </style>
</head>
<body>
    <div class="login-container">
        <h2>Welcome Back</h2>
        <form id="loginForm" onsubmit="return validateForm(event)">
            <div class="form-group">
                <input type="text" id="username" name="username" placeholder=" " required>
                <label for="username">Username</label>
                <span id="username-error" class="error-message"></span>
            </div>
            <div class="form-group">
                <input type="password" id="password" name="password" placeholder=" " required>
                <label for="password">Password</label>
                <span id="password-error" class="error-message"></span>
            </div>
            <button type="submit">Sign In</button>
            <p id="error-message" class="error-message"></p>
        </form>
    </div>

    <script>
        if (localStorage.getItem("isLoggedIn") === "true") {
            window.location.replace("./proxy.html");
        }

        async function validateForm(event) {
            event.preventDefault();
            
            const username = document.getElementById("username");
            const password = document.getElementById("password");
            const usernameError = document.getElementById("username-error");
            const passwordError = document.getElementById("password-error");
            const errorMessage = document.getElementById("error-message");
            
            username.classList.remove('input-error');
            password.classList.remove('input-error');
            usernameError.textContent = '';
            passwordError.textContent = '';
            errorMessage.textContent = '';

            let isValid = true;
            const usernameValue = username.value.trim();
            if (!usernameValue) {
                usernameError.textContent = "ইউজারনেম প্রয়োজন";
                username.classList.add('input-error');
                isValid = false;
            } else if (usernameValue.length < 3) {
                usernameError.textContent = "ইউজারনেম কমপক্ষে ৩ অক্ষরের হতে হবে";
                username.classList.add('input-error');
                isValid = false;
            } else if (!/^[a-zA-Z0-9_]+$/.test(usernameValue)) {
                usernameError.textContent = "শুধুমাত্র অক্ষর, সংখ্যা এবং আন্ডারস্কোর ব্যবহার করুন";
                username.classList.add('input-error');
                isValid = false;
            }

            const passwordValue = password.value.trim();
            if (!passwordValue) {
                passwordError.textContent = "পাসওয়ার্ড প্রয়োজন";
                password.classList.add('input-error');
                isValid = false;
            } else if (passwordValue.length < 6) {
                passwordError.textContent = "পাসওয়ার্ড কমপক্ষে ৬ অক্ষরের হতে হবে";
                password.classList.add('input-error');
                isValid = false;
            }

            if (!isValid) return false;

            try {
                const response = await fetch('credentials.json');
                const data = await response.json();
                
                const user = data.users.find(u => 
                    u.username === usernameValue && 
                    u.password === passwordValue
                );
                
                if (user) {
                    localStorage.setItem("isLoggedIn", "true");
                    console.log("Login successful, isLoggedIn:", localStorage.getItem("isLoggedIn"));
                    errorMessage.textContent = "লগইন সফল! রিডাইরেক্ট হচ্ছে...";
                    errorMessage.style.color = "#16a34a";
                    errorMessage.classList.remove('error');
                    
                    setTimeout(() => {
                        console.log("Redirecting to proxy.html");
                        window.location.replace("./proxy.html");
                    }, 1500);
                } else {
                    errorMessage.textContent = "ভুল ইউজারনেম বা পাসওয়ার্ড";
                    errorMessage.style.color = "#dc2626";
                    errorMessage.classList.add('error', 'shake');
                    setTimeout(() => errorMessage.classList.remove('shake'), 500);
                }
            } catch (error) {
                errorMessage.textContent = "সার্ভারে সমস্যা, পরে চেষ্টা করুন";
                errorMessage.style.color = "#dc2626";
                errorMessage.classList.add('error', 'shake');
                setTimeout(() => errorMessage.classList.remove('shake'), 500);
                console.error(error);
            }
            return false;
        }

        ['username', 'password'].forEach(field => {
            document.getElementById(field).addEventListener('input', function() {
                this.classList.remove('input-error');
                document.getElementById(`${field}-error`).textContent = '';
            });
        });
    </script>
</body>
</html>
