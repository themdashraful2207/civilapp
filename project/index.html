<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConnectEarn - Social Earning Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-color);
        }

        .logo i {
            font-size: 2rem;
        }

        #user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        #points-balance {
            background-color: var(--primary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .hidden {
            display: none !important;
        }

        /* Login Section */
        #login-section {
            text-align: center;
            padding: 2rem;
        }

        .login-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 2rem 0;
        }

        .login-card {
            background: white;
            padding: 2rem 1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .login-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .login-card i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        #login-form {
            max-width: 400px;
            margin: 2rem auto;
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #login-form input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .demo-note {
            font-size: 0.8rem;
            color: var(--secondary-color);
            margin-top: 1rem;
        }

        /* Common Section Styles */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .card-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .problem-card, .transaction-card, .host-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary-color);
        }

        .problem-card h4, .transaction-card h4 {
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status.open {
            background-color: #d4edda;
            color: var(--success-color);
        }

        .status.pending {
            background-color: #fff3cd;
            color: var(--warning-color);
        }

        .status.completed {
            background-color: #f8d7da;
            color: var(--danger-color);
        }

        /* Buttons */
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        button.primary {
            background-color: var(--primary-color);
            color: white;
        }

        button.primary:hover {
            background-color: #3a5bef;
        }

        button.secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        button.danger {
            background-color: var(--danger-color);
            color: white;
        }

        button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* Forms */
        textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            min-height: 100px;
            resize: vertical;
        }

        select {
            width: 100%;
            padding: 10px;
            margin-bottom: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 1rem;
        }

        .form-row input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Points Display */
        .points-display {
            display: flex;
            align-items: center;
            gap: 5px;
            background-color: #f8f9fa;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
        }

        .points-display i {
            color: var(--warning-color);
        }

        /* Admin Cards */
        .admin-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .admin-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .admin-card h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .stats div {
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        /* Messages */
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .message.success {
            background-color: #d4edda;
            color: var(--success-color);
        }

        .message.error {
            background-color: #f8d7da;
            color: var(--danger-color);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
            color: var(--secondary-color);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-hand-holding-heart"></i>
            <h1>ConnectEarn</h1>
        </div>
        <div id="user-info">
            <span id="current-role">Not logged in</span>
            <span id="points-balance" class="hidden"></span>
            <button id="logout-btn" class="hidden">Logout</button>
        </div>
    </header>

    <div class="container">
        <!-- Login Screen -->
        <div id="login-section">
            <h2>Welcome to ConnectEarn</h2>
            <div class="login-options">
                <div class="login-card" data-role="client">
                    <i class="fas fa-user"></i>
                    <h3>Client</h3>
                    <p>Post your problems</p>
                </div>
                <div class="login-card" data-role="repeater">
                    <i class="fas fa-bullhorn"></i>
                    <h3>Repeater</h3>
                    <p>Suggest solutions</p>
                </div>
                <div class="login-card" data-role="host">
                    <i class="fas fa-briefcase"></i>
                    <h3>Host</h3>
                    <p>Provide services</p>
                </div>
                <div class="login-card" data-role="admin">
                    <i class="fas fa-cog"></i>
                    <h3>Admin</h3>
                    <p>Manage platform</p>
                </div>
            </div>

            <div id="login-form" class="hidden">
                <h3>Login as <span id="role-name"></span></h3>
                <input type="text" id="username" placeholder="Username">
                <input type="password" id="password" placeholder="Password">
                <button id="login-btn" class="primary">Login</button>
                <p class="demo-note">For demo: Any credentials will work</p>
            </div>
        </div>

        <!-- Client Section -->
        <div id="client-section" class="hidden">
            <div class="section-header">
                <h2><i class="fas fa-question-circle"></i> Post Your Problem</h2>
                <button id="refresh-problems-btn"><i class="fas fa-sync-alt"></i> Refresh</button>
            </div>
            
            <div class="card">
                <textarea id="client-problem" placeholder="Describe your problem in detail..."></textarea>
                <button id="post-problem-btn" class="primary"><i class="fas fa-paper-plane"></i> Submit Problem</button>
                <div id="client-message" class="message"></div>
            </div>

            <h3><i class="fas fa-history"></i> Your Problems</h3>
            <div id="client-problems-list" class="card-list"></div>
        </div>

        <!-- Repeater Section -->
        <div id="repeater-section" class="hidden">
            <div class="section-header">
                <h2><i class="fas fa-lightbulb"></i> Suggest Solutions</h2>
                <div class="points-display">
                    <i class="fas fa-coins"></i>
                    <span id="repeater-points">0</span> points
                </div>
            </div>

            <h3><i class="fas fa-list"></i> Open Problems</h3>
            <div id="problems-list" class="card-list"></div>

            <div id="suggestion-form" class="card hidden">
                <h4>Suggest a Host for Problem #<span id="current-problem-id"></span></h4>
                <p id="current-problem-text"></p>
                <select id="host-select">
                    <option value="">Select Host</option>
                </select>
                <button id="suggest-host-btn" class="primary"><i class="fas fa-check"></i> Submit Suggestion</button>
                <button id="cancel-suggestion-btn"><i class="fas fa-times"></i> Cancel</button>
            </div>

            <h3><i class="fas fa-trophy"></i> Your Successful Suggestions</h3>
            <div id="repeater-success-list" class="card-list"></div>
        </div>

        <!-- Host Section -->
        <div id="host-section" class="hidden">
            <div class="section-header">
                <h2><i class="fas fa-briefcase"></i> Your Services</h2>
                <div class="points-display">
                    <i class="fas fa-coins"></i>
                    <span id="host-points">100</span> points available
                </div>
            </div>

            <h3><i class="fas fa-bell"></i> Pending Requests</h3>
            <div id="host-requests" class="card-list"></div>

            <h3><i class="fas fa-history"></i> Completed Services</h3>
            <div id="host-completed-list" class="card-list"></div>
        </div>

        <!-- Admin Section -->
        <div id="admin-section" class="hidden">
            <div class="section-header">
                <h2><i class="fas fa-cog"></i> Admin Dashboard</h2>
            </div>

            <div class="admin-cards">
                <div class="admin-card">
                    <h3><i class="fas fa-users"></i> Users</h3>
                    <div class="stats">
                        <div>Clients: <span id="client-count">0</span></div>
                        <div>Repeaters: <span id="repeater-count">0</span></div>
                        <div>Hosts: <span id="host-count">0</span></div>
                    </div>
                </div>

                <div class="admin-card">
                    <h3><i class="fas fa-exchange-alt"></i> Transactions</h3>
                    <div class="stats">
                        <div>Today: <span id="today-tx">0</span></div>
                        <div>Total: <span id="total-tx">0</span></div>
                        <div>Points: <span id="total-points">0</span></div>
                    </div>
                </div>
            </div>

            <h3><i class="fas fa-list"></i> All Transactions</h3>
            <div id="transactions-list" class="card-list"></div>

            <h3><i class="fas fa-user-cog"></i> Manage Hosts</h3>
            <div class="card">
                <div class="form-row">
                    <input type="text" id="new-host-name" placeholder="Host name">
                    <input type="number" id="new-host-points" placeholder="Initial points" value="100">
                    <button id="add-host-btn" class="primary"><i class="fas fa-plus"></i> Add Host</button>
                </div>
                <div id="hosts-list"></div>
            </div>
        </div>
    </div>

    <footer>
        <p>ConnectEarn &copy; 2023 | Social Earning Platform</p>
    </footer>

    <script>
        // Data Storage
        let users = {
            clients: ['client1', 'client2'],
            repeaters: ['repeater1', 'repeater2'],
            hosts: ['host1', 'host2', 'host3'],
            admin: ['admin']
        };

        let problems = [];
        let transactions = [];
        let hostList = [
            { id: "host1", name: "Tech Solutions Inc.", points: 100, category: "Technology" },
            { id: "host2", name: "Legal Associates", points: 100, category: "Legal" },
            { id: "host3", name: "Business Consultants", points: 100, category: "Business" }
        ];

        let userPoints = {
            repeater1: 0,
            repeater2: 0,
            host1: 100,
            host2: 100,
            host3: 100
        };

        // Current User
        let currentUser = null;
        let currentRole = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage
            loadData();
            
            // Set up event listeners
            setupEventListeners();
            
            // Check if user is already logged in from session
            checkSession();
        });

        function loadData() {
            try {
                const savedUsers = localStorage.getItem('users');
                const savedProblems = localStorage.getItem('problems');
                const savedTransactions = localStorage.getItem('transactions');
                const savedHostList = localStorage.getItem('hostList');
                const savedUserPoints = localStorage.getItem('userPoints');

                if (savedUsers) users = JSON.parse(savedUsers);
                if (savedProblems) problems = JSON.parse(savedProblems);
                if (savedTransactions) transactions = JSON.parse(savedTransactions);
                if (savedHostList) hostList = JSON.parse(savedHostList);
                if (savedUserPoints) userPoints = JSON.parse(savedUserPoints);
            } catch (e) {
                console.error("Error loading data:", e);
            }
        }

        function saveData() {
            try {
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('problems', JSON.stringify(problems));
                localStorage.setItem('transactions', JSON.stringify(transactions));
                localStorage.setItem('hostList', JSON.stringify(hostList));
                localStorage.setItem('userPoints', JSON.stringify(userPoints));
            } catch (e) {
                console.error("Error saving data:", e);
            }
        }

        function setupEventListeners() {
            // Login cards
            document.querySelectorAll('.login-card').forEach(card => {
                card.addEventListener('click', function() {
                    const role = this.getAttribute('data-role');
                    showLoginForm(role);
                });
            });

            // Login button
            document.getElementById('login-btn').addEventListener('click', login);

            // Logout button
            document.getElementById('logout-btn').addEventListener('click', logout);

            // Client buttons
            document.getElementById('post-problem-btn').addEventListener('click', postProblem);
            document.getElementById('refresh-problems-btn').addEventListener('click', refreshProblems);

            // Repeater buttons
            document.getElementById('suggest-host-btn').addEventListener('click', suggestHost);
            document.getElementById('cancel-suggestion-btn').addEventListener('click', cancelSuggestion);

            // Admin buttons
            document.getElementById('add-host-btn').addEventListener('click', addHost);
        }

        function checkSession() {
            const session = sessionStorage.getItem('currentUser');
            if (session) {
                const { user, role } = JSON.parse(session);
                currentUser = user;
                currentRole = role;
                updateUIAfterLogin();
            }
        }

        function showLoginForm(role) {
            document.getElementById('role-name').textContent = role.charAt(0).toUpperCase() + role.slice(1);
            document.getElementById('login-form').classList.remove('hidden');
        }

        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value; // Not used in demo

            if (!username) {
                alert("Please enter a username");
                return;
            }

            // Determine role
            let role = null;
            if (users.clients.includes(username)) role = 'client';
            else if (users.repeaters.includes(username)) role = 'repeater';
            else if (users.hosts.includes(username)) role = 'host';
            else if (users.admin.includes(username)) role = 'admin';
            else {
                // Auto-create user for demo
                if (username.startsWith('client')) {
                    users.clients.push(username);
                    role = 'client';
                } else if (username.startsWith('repeater')) {
                    users.repeaters.push(username);
                    userPoints[username] = 0;
                    role = 'repeater';
                } else if (username.startsWith('host')) {
                    if (!hostList.some(h => h.id === username)) {
                        hostList.push({
                            id: username,
                            name: `${username.charAt(0).toUpperCase() + username.slice(1)} Services`,
                            points: 100,
                            category: "General"
                        });
                    }
                    userPoints[username] = 100;
                    users.hosts.push(username);
                    role = 'host';
                } else if (username === 'admin') {
                    role = 'admin';
                } else {
                    alert("Invalid credentials for demo. Try client1, repeater1, host1, or admin");
                    return;
                }
                saveData();
            }

            // Login successful
            currentUser = username;
            currentRole = role;
            
            // Save session
            sessionStorage.setItem('currentUser', JSON.stringify({ user: username, role: role }));
            
            // Update UI
            updateUIAfterLogin();
        }

        function updateUIAfterLogin() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('login-section').classList.add('hidden');
            
            document.getElementById('current-role').textContent = 
                `${currentRole.charAt(0).toUpperCase() + currentRole.slice(1)}: ${currentUser}`;
            
            if (currentRole === 'repeater' || currentRole === 'host') {
                document.getElementById('points-balance').textContent = `${userPoints[currentUser] || 0} points`;
                document.getElementById('points-balance').classList.remove('hidden');
            } else {
                document.getElementById('points-balance').classList.add('hidden');
            }
            
            document.getElementById('logout-btn').classList.remove('hidden');
            
            // Hide all sections first
            document.getElementById('client-section').classList.add('hidden');
            document.getElementById('repeater-section').classList.add('hidden');
            document.getElementById('host-section').classList.add('hidden');
            document.getElementById('admin-section').classList.add('hidden');
            
            // Show current role's section
            document.getElementById(`${currentRole}-section`).classList.remove('hidden');
            
            // Load role-specific data
            switch(currentRole) {
                case 'client':
                    loadClientProblems();
                    break;
                case 'repeater':
                    loadRepeaterData();
                    break;
                case 'host':
                    loadHostData();
                    break;
                case 'admin':
                    loadAdminData();
                    break;
            }
        }

        function logout() {
            currentUser = null;
            currentRole = null;
            sessionStorage.removeItem('currentUser');
            
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('client-section').classList.add('hidden');
            document.getElementById('repeater-section').classList.add('hidden');
            document.getElementById('host-section').classList.add('hidden');
            document.getElementById('admin-section').classList.add('hidden');
            
            document.getElementById('points-balance').classList.add('hidden');
            document.getElementById('logout-btn').classList.add('hidden');
            document.getElementById('current-role').textContent = "Not logged in";
            
            // Clear form fields
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Client Functions
        function postProblem() {
            const problemText = document.getElementById('client-problem').value.trim();
            
            if (!problemText) {
                showMessage('client-message', 'Please enter a problem description', 'error');
                return;
            }

            const newProblem = {
                id: Date.now(),
                text: problemText,
                client: currentUser,
                status: 'open',
                suggestedHost: null,
                repeater: null,
                timestamp: new Date().toISOString()
            };

            problems.push(newProblem);
            saveData();
            
            document.getElementById('client-problem').value = '';
            showMessage('client-message', 'Problem posted successfully!', 'success');
            loadClientProblems();
        }

        function loadClientProblems() {
            const clientProblems = problems.filter(p => p.client === currentUser);
            const listElement = document.getElementById('client-problems-list');
            listElement.innerHTML = '';

            if (clientProblems.length === 0) {
                listElement.innerHTML = '<div class="card"><p>You haven\'t posted any problems yet.</p></div>';
                return;
            }

            clientProblems.forEach(problem => {
                const statusClass = problem.status === 'open' ? 'open' : 
                                  problem.status === 'pending' ? 'pending' : 'completed';
                
                let hostInfo = '';
                if (problem.suggestedHost) {
                    const host = hostList.find(h => h.id === problem.suggestedHost);
                    hostInfo = `<p><strong>Suggested Host:</strong> ${host ? host.name : problem.suggestedHost}</p>`;
                }
                
                listElement.innerHTML += `
                    <div class="problem-card">
                        <h4>Problem #${problem.id}</h4>
                        <p>${problem.text}</p>
                        ${hostInfo}
                        <div class="status ${statusClass}">${problem.status}</div>
                    </div>
                `;
            });
        }

        function refreshProblems() {
            loadClientProblems();
            showMessage('client-message', 'Problems refreshed', 'success');
        }

        // Repeater Functions
        function loadRepeaterData() {
            loadOpenProblems();
            loadRepeaterSuccess();
            updateRepeaterPoints();
        }

        function loadOpenProblems() {
            const openProblems = problems.filter(p => p.status === 'open');
            const listElement = document.getElementById('problems-list');
            listElement.innerHTML = '';

            if (openProblems.length === 0) {
                listElement.innerHTML = '<div class="card"><p>No open problems available.</p></div>';
                return;
            }

            openProblems.forEach(problem => {
                listElement.innerHTML += `
                    <div class="problem-card">
                        <h4>Problem #${problem.id}</h4>
                        <p>${problem.text}</p>
                        <p><small>Posted by: ${problem.client}</small></p>
                        <button class="suggest-host-btn primary" data-problem-id="${problem.id}">
                            <i class="fas fa-lightbulb"></i> Suggest Host
                        </button>
                    </div>
                `;
            });

            // Add event listeners to suggestion buttons
            document.querySelectorAll('.suggest-host-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const problemId = parseInt(this.getAttribute('data-problem-id'));
                    showSuggestionForm(problemId);
                });
            });
        }

        function showSuggestionForm(problemId) {
            const problem = problems.find(p => p.id === problemId);
            if (!problem) return;

            document.getElementById('current-problem-id').textContent = problemId;
            document.getElementById('current-problem-text').textContent = problem.text;
            
            // Populate host select
            const hostSelect = document.getElementById('host-select');
            hostSelect.innerHTML = '<option value="">Select Host</option>';
            
            hostList.forEach(host => {
                hostSelect.innerHTML += `<option value="${host.id}">${host.name} (${host.category})</option>`;
            });

            document.getElementById('problems-list').classList.add('hidden');
            document.getElementById('suggestion-form').classList.remove('hidden');
        }

        function cancelSuggestion() {
            document.getElementById('problems-list').classList.remove('hidden');
            document.getElementById('suggestion-form').classList.add('hidden');
        }

        function suggestHost() {
            const hostId = document.getElementById('host-select').value;
            const problemId = parseInt(document.getElementById('current-problem-id').textContent);
            
            if (!hostId) {
                showMessage('repeater-message', 'Please select a host', 'error');
                return;
            }

            const problem = problems.find(p => p.id === problemId);
            if (!problem || problem.status !== 'open') {
                showMessage('repeater-message', 'Problem is no longer available', 'error');
                return;
            }

            problem.suggestedHost = hostId;
            problem.status = 'pending';
            problem.repeater = currentUser;
            saveData();

            showMessage('repeater-message', 'Host suggested successfully!', 'success');
            cancelSuggestion();
            loadRepeaterData();
        }

        function loadRepeaterSuccess() {
            const successfulProblems = problems.filter(p => p.repeater === currentUser && p.status === 'completed');
            const listElement = document.getElementById('repeater-success-list');
            listElement.innerHTML = '';

            if (successfulProblems.length === 0) {
                listElement.innerHTML = '<div class="card"><p>No successful suggestions yet.</p></div>';
                return;
            }

            successfulProblems.forEach(problem => {
                const host = hostList.find(h => h.id === problem.suggestedHost);
                listElement.innerHTML += `
                    <div class="problem-card">
                        <h4>Problem #${problem.id}</h4>
                        <p>${problem.text}</p>
                        <p><strong>Host:</strong> ${host ? host.name : problem.suggestedHost}</p>
                        <p><strong>Earned:</strong> 10 points</p>
                    </div>
                `;
            });
        }

        function updateRepeaterPoints() {
            document.getElementById('repeater-points').textContent = userPoints[currentUser] || 0;
        }

        // Host Functions
        function loadHostData() {
            loadHostRequests();
            loadHostCompleted();
            updateHostPoints();
        }

        function loadHostRequests() {
            const pendingProblems = problems.filter(p => p.suggestedHost === currentUser && p.status === 'pending');
            const listElement = document.getElementById('host-requests');
            listElement.innerHTML = '';

            if (pendingProblems.length === 0) {
                listElement.innerHTML = '<div class="card"><p>No pending requests.</p></div>';
                return;
            }

            pendingProblems.forEach(problem => {
                listElement.innerHTML += `
                    <div class="problem-card">
                        <h4>Problem #${problem.id}</h4>
                        <p>${problem.text}</p>
                        <p><small>Suggested by: ${problem.repeater}</small></p>
                        <div class="form-row">
                            <button class="accept-client-btn primary" data-problem-id="${problem.id}">
                                <i class="fas fa-check"></i> Accept & Reward (10 points)
                            </button>
                            <button class="reject-client-btn danger" data-problem-id="${problem.id}">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </div>
                    </div>
                `;
            });

            // Add event listeners
            document.querySelectorAll('.accept-client-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const problemId = parseInt(this.getAttribute('data-problem-id'));
                    acceptClient(problemId);
                });
            });

            document.querySelectorAll('.reject-client-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const problemId = parseInt(this.getAttribute('data-problem-id'));
                    rejectClient(problemId);
                });
            });
        }

        function acceptClient(problemId) {
            const problem = problems.find(p => p.id === problemId);
            if (!problem || problem.status !== 'pending' || problem.suggestedHost !== currentUser) {
                showMessage('host-message', 'Invalid request', 'error');
                return;
            }

            // Check if host has enough points
            if (userPoints[currentUser] < 10) {
                showMessage('host-message', 'Not enough points to reward repeater', 'error');
                return;
            }

            problem.status = 'completed';
            
            // Create transaction
            const transaction = {
                id: Date.now(),
                problemId: problemId,
                hostId: currentUser,
                repeaterId: problem.repeater,
                points: 10,
                timestamp: new Date().toISOString()
            };
            transactions.push(transaction);
            
            // Update points
            userPoints[currentUser] -= 10;
            userPoints[problem.repeater] = (userPoints[problem.repeater] || 0) + 10;
            
            saveData();
            showMessage('host-message', 'Client accepted! Repeater rewarded with 10 points.', 'success');
            loadHostData();
        }

        function rejectClient(problemId) {
            const problem = problems.find(p => p.id === problemId);
            if (!problem || problem.status !== 'pending' || problem.suggestedHost !== currentUser) {
                showMessage('host-message', 'Invalid request', 'error');
                return;
            }

            problem.status = 'open';
            problem.suggestedHost = null;
            problem.repeater = null;
            saveData();
            
            showMessage('host-message', 'Request rejected. Problem is now open for other suggestions.', 'success');
            loadHostData();
        }

        function loadHostCompleted() {
            const completedProblems = problems.filter(p => p.suggestedHost === currentUser && p.status === 'completed');
            const listElement = document.getElementById('host-completed-list');
            listElement.innerHTML = '';

            if (completedProblems.length === 0) {
                listElement.innerHTML = '<div class="card"><p>No completed services yet.</p></div>';
                return;
            }

            completedProblems.forEach(problem => {
                listElement.innerHTML += `
                    <div class="problem-card">
                        <h4>Problem #${problem.id}</h4>
                        <p>${problem.text}</p>
                        <p><small>Repeater: ${problem.repeater}</small></p>
                        <p><strong>Points spent:</strong> 10</p>
                    </div>
                `;
            });
        }

        function updateHostPoints() {
            document.getElementById('host-points').textContent = userPoints[currentUser] || 0;
        }

        // Admin Functions
        function loadAdminData() {
            updateStats();
            loadAllTransactions();
            loadHostsList();
        }

        function updateStats() {
            document.getElementById('client-count').textContent = users.clients.length;
            document.getElementById('repeater-count').textContent = users.repeaters.length;
            document.getElementById('host-count').textContent = users.hosts.length;
            
            const today = new Date().toISOString().split('T')[0];
            const todayTx = transactions.filter(tx => tx.timestamp.split('T')[0] === today).length;
            document.getElementById('today-tx').textContent = todayTx;
            document.getElementById('total-tx').textContent = transactions.length;
            
            const totalPoints = transactions.reduce((sum, tx) => sum + tx.points, 0);
            document.getElementById('total-points').textContent = totalPoints;
        }

        function loadAllTransactions() {
            const listElement = document.getElementById('transactions-list');
            listElement.innerHTML = '';

            if (transactions.length === 0) {
                listElement.innerHTML = '<div class="card"><p>No transactions yet.</p></div>';
                return;
            }

            transactions.slice().reverse().forEach(tx => {
                const date = new Date(tx.timestamp).toLocaleString();
                listElement.innerHTML += `
                    <div class="transaction-card">
                        <h4>Transaction #${tx.id}</h4>
                        <p><strong>Problem:</strong> #${tx.problemId}</p>
                        <p><strong>Host:</strong> ${tx.hostId}</p>
                        <p><strong>Repeater:</strong> ${tx.repeaterId}</p>
                        <p><strong>Points:</strong> ${tx.points}</p>
                        <p><small>${date}</small></p>
                    </div>
                `;
            });
        }

        function loadHostsList() {
            const listElement = document.getElementById('hosts-list');
            listElement.innerHTML = '';

            hostList.forEach(host => {
                listElement.innerHTML += `
                    <div class="host-card">
                        <h4>${host.name}</h4>
                        <p><strong>ID:</strong> ${host.id}</p>
                        <p><strong>Category:</strong> ${host.category}</p>
                        <p><strong>Points:</strong> ${userPoints[host.id] || 0}</p>
                        <button class="delete-host-btn danger" data-host-id="${host.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
            });

            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-host-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const hostId = this.getAttribute('data-host-id');
                    deleteHost(hostId);
                });
            });
        }

        function addHost() {
            const name = document.getElementById('new-host-name').value.trim();
            const points = parseInt(document.getElementById('new-host-points').value) || 100;
            
            if (!name) {
                alert("Please enter host name");
                return;
            }

            const hostId = `host${Date.now()}`;
            hostList.push({
                id: hostId,
                name: name,
                points: points,
                category: "General"
            });
            
            users.hosts.push(hostId);
            userPoints[hostId] = points;
            
            saveData();
            document.getElementById('new-host-name').value = '';
            loadHostsList();
            updateStats();
        }

        function deleteHost(hostId) {
            if (!confirm(`Are you sure you want to delete host ${hostId}?`)) return;
            
            hostList = hostList.filter(h => h.id !== hostId);
            users.hosts = users.hosts.filter(h => h !== hostId);
            delete userPoints[hostId];
            
            // Remove any problems associated with this host
            problems = problems.filter(p => p.suggestedHost !== hostId);
            
            saveData();
            loadHostsList();
            updateStats();
        }

        // Helper Functions
        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => element.innerHTML = '', 3000);
        }

        // Make functions available globally for HTML onclick attributes
        window.login = login;
        window.logout = logout;
        window.postProblem = postProblem;
        window.refreshProblems = refreshProblems;
        window.suggestHost = suggestHost;
        window.cancelSuggestion = cancelSuggestion;
        window.acceptClient = acceptClient;
        window.rejectClient = rejectClient;
        window.addHost = addHost;
        window.deleteHost = deleteHost;
    </script>
</body>
</html>
